# ■ 「UE4におけるエフェクトの為のエンジン改造事例」の要約

# ■ スライドへのリンク
* [{SlideShare} UE4におけるエフェクトの為のエンジン改造事例](https://www.slideshare.net/EpicGamesJapan/ue4-138425416)

# ■ 要約
* 概要
	* エフェクトに関するエンジン改造の事例をまとめてあります。
	* 一例として以下の改造をしています。
		* エディタ（Cascade/Niagara/Matinee）
		* ParticleSystem（システム自体、コンポーネント、エミッタ、GPU Particle）
		* モジュール（既存（Emitter/Particle/ポストプロセス/外部制御/Material）の拡張、追加）
		* 制御関連（マネージャクラス、アタッチ、マテリアル）
		* 環境関連（ツール、デバッグ環境、自動化、並列化、最適化）
	* 拡張の動機やどのように行ったかをまとめてあります。
	* 具体的な拡張内容の説明に最もページが割かれていて、このスライドのメインコンテンツとなっています。
	* こちらはプログラマーサイドのスライドとなっています。
		* [UE4におけるエフェクトの基本戦略事例](UE4におけるエフェクトの基本戦略事例.md) がデザイナーサイドです。
		* 内容的に補完しあっている部分があるので両方読んだほうがよいです。
* 読むべき人
	* 主たるターゲット
		* プログラマー（リード、エフェクト描画担当、エンジン拡張担当、最適化担当、自動化・ビルド担当）
	* 補助的なターゲット
		* デザイナー（リード、サブリード、ＴＡ）
		* ディレクター（工数把握）

# ■ 講演者
* プログラマーの細川拓馬氏の講演
	* エネミー、ギミック、ツール、ＶＦＸプログラマー、エンジンの改造や拡張、デザイナーのサポート等を経験してきた

# ■ スライド内容のメモ
* ※ここから先はほぼスライドの内容全部を書き写しただけのスライド全体の俯瞰用のテキスト
* ※改造の具体的な内容は、メモを読むより直接スライドを見たほうがよいです。
* 内容詳細
	* **項目が多いので詳細はスライド参照**
* 環境について
	* エンジン側のプロジェクトを改造（プラグインやゲーム側だけだと完結しなかった）
	* 基本的には既存のコードを改造、足りないものは作成
	* エフェクト用の BP は専用 Actor を作成
	* エフェクトの生成は Spawn Emitter を拡張したものを使用、制限は特になし。
	* コードの改造時はコメントを残す（バージョンアップ時のマージのため？）
	* 作成したモジュール数
		* 都合 100 程度。
		* **項目が多いので詳細はスライド参照**
* なぜ拡張したのか
	* デザイナーからの要望（機能不足、エフェクト単体で起承転結が作りづらい、作業効率の悪さ、品質）
	* Cascade の開発終了、新 Effect 環境（ Niagara ） がリリースされない
	* BP での作成では作業難度が高くデザイナが対応できない
	* 方針
		* ~~そこまで拡張しない。~~ それなりに改造拡張する、 Module の追加もする
		* 足りない機能は~~無理せず~~なるべく作る。
		* ~~BP で補えるところは補おう。~~ 基本は Particle System で制御する
		* ツールはプラグインで作る
* 改造のメリットとデメリット
	* メリット
		* デザイナーの要望に応えやすく、作業効率やクオリティが改善する
		* コードでの拡張によるプログラマー業務の恩恵（BP に関する問題が発生しない、デバッグしやすい、最適化しやすい、空プロジェクトでの実験が可能）
	* デメリット
		* ３か月程度の感覚でエンジンがアップデートされ、対応（マージと動作確認）に２週間程度かかる
		* UDN の情報の反映が難しケースがある、エンジン側での対処の適用が先のバージョンのケースがある
		* プロジェクト間でのエンジン共有が困難
* 改造したものと作ったもの
	* **非常に数が多いので、詳細はスライド参照**
	* SQEX Tag
		* エフェクトに対するコメント、担当者、タスクの状態、 Module の内容などを保存。ツールにて検索も可能。外部ツールと連携させることも検討
	* Tick Group
		* デフォルトの DuringPhysics から EndPhysics に変更
		* その他、 LastEffectUpdate の追加（他の処理が終了した後に処理するエフェクト用）
		* **その他の用途での追加した Tick Group の情報もある、詳細はスライド参照**
	* 識別 ID
		* 生成後に識別 ID 単位で各種処理を行うために用意（生成や制御、特殊処理や収量の通知など）
	* サウンド指定
		* 内容はデータアセットに記述し、データアセットを指定する形
		* 上記識別 ID の制御対象
	* エフェクトのフェード
		* 独自で用意した、 Particle Color の Alpha をマテリアルが参照する形
		* Alpha 値の指定は BP やモジュールなどを経由して行う
	* エラーチェック機能
		* 寿命を持たないパーティクル
		* 複製の際に LOD を意図せず複製するケース

----
以上。
