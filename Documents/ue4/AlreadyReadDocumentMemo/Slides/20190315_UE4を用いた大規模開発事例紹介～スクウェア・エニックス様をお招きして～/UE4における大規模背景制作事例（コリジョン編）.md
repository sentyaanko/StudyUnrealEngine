# ■ 「UE4における大規模背景制作事例」の要約

# ■ スライドへのリンク
* [{SlideShare} UE4における大規模背景制作事例（コリジョン編）](https://www.slideshare.net/EpicGamesJapan/ue4-138425097)

# ■ 要約
* 概要
	* コリジョン周りの苦労を共有のためまとめられています。
	* 特に問題点に関して多くの事例がまとめられています。
* 読むべき人
	* 主たるターゲット
		* デザイナー（リード、サブリード、背景担当）
	* 補助的なターゲット
		* プログラマー（リード、背景担当、コリジョン・PhysX 担当）
		* ディレクター（工数把握）

# ■ 講演者
* エンバイロメントアーティストの近藤希予志氏
	* environment(環境)
	* 背景アーティスト

# ■ スライド内容のメモ
* ※ここから先はほぼスライドの内容全部を書き写しただけのスライド全体の俯瞰用のテキスト
* ワークフローの改善
	* 前作
		* UE4 が初めてだったため、作りながら仕様が決まっていっため、開発工機に問題が発生するなど後手後手になった
		* コリジョンを考慮しないアセット群、過剰な仕様
	* 今作での対応
		* 人と時間を割いた
		* 仕様確認と内容調整、ドキュメント化
		* **自動プレー、テスト班の導入**
	* 効果
		* コールセンターの問い合わせがかなり減少、バグの少なさがネットでも評価されていた
* 運用事例
	* コリジョンの種類、物理ボリューム、ランドスケープに関する使い分け
	* 地形ごとのウォーカブル設定、コリジョンプリセット、物理マテリアル設定、**コリジョン属性（ぶら下がり、壁のぼり、壁けり）**
		* これらの可視化
	* 自動凸型分解（ AutoConvexCollision ）は使わない（ QA からの NG ）
		* レベルデザインに直結するため、自動化されたものだと問題が紛れ込みやすい
	* コリジョン法線
		* ハードエッジ。ウォーカブルの境界などの判定結果を正しくするため
	* IK コリジョン
		* 足の設置艦の向上のため、階段などで局所的に利用
		* 表示モデル参照は処理とメンテコストがかかる
		* データ作成、管理コストはその分増える
	* 動く地形
		* Simple で対応、Complex だと中身がないのでコリジョン抜けが発生
	* ナビメッシュ
		* 基本５、特大３
	* ウォーターカレント
		* 水漏れ、川流れ、吹雪、扇風機などで利用
		* ボリュームに入るとパスに沿って押される表現
* 最適化事例
	* シンプルに（コリジョンのトライアングル数は表示の 1/10 、プリミティブ数 50 以内で超える場合は Complex にするなど）
	* 不要なコリジョンの削除（入れ子をなくす、移動範囲外を消すまたはカメラ用にシンプルなものを用意するなど）
	* 密集したコリジョンの整理（入り組んだものは簡略化、合成）
	* 大きい（メートル越え）コリジョン分割（作業コストの割に効果が薄かったため、限定的）
	* 負荷が上がる条件
		* 大きい、早い、高低差、多いなど
		* 特に大きい敵などは動いた際にあちこちのコリジョンにヒットしやすい
	* Simple コリジョンについて
		* プリミティブ数が多くくなると負荷と使用メモリが増える
		* なるべく少なく保ち、多くなるなら Complex に置き換える
		* 例： Simple:Complex のプリミティブが 500:1 でトライアングルが同数のケースで後者に変えたところ PhysX の使用メモリが 1/4 になった
	* 負荷計測はすべて実装した後でないと意味がなかった
* 問題点
	* Complex のコリジョン抜けの判定ができない
		* 絵作りの担保のため利用した
	* ナビメッシュへの配慮
		* 点検がおろそかになりがち、定期チェックが必要
		* ゲーム進行に影響するので不具合発生への注意が必要
	* Simple コリジョンへの物理マテリアル設定が１つのみ
		* 複数設定したい場合はその分用意
	* コリジョンプリセットの組み合わせ爆発
		* 担当者がいなくなり用と不明のものなどもあった
	* 物理マテリアルの管理
		* 担当者が自由に追加できたので増えていった
	* ウォーカブル設定
		* 任意に変更を許していたためトラブルの元だった
	* 足音設定などの物理ボリューム数
		* 頑張れば細かく設定できるため、数が増え過ぎた
		* メンテ優先のレギュレーションを立てた
	* カットシーンとインゲームのコリジョンの差
		* カットシーンでは表示モデルを参照していたため、コリジョンがずれていた
		* コリジョンのほうを合うように調整した
	* フォトモード時などのレイキャストでの問題
		* 木の葉がコリジョンなしのためレイが貫通する、屋台がコリジョンに包まれているため、レイが通過しない、など
		* メモリ削減のため Simple コリジョンにしていたが、 Complex コリジョンをつけた
	* PhysX の問題
		* カプセル同士の計算誤差で稀にコリジョン抜けが発生していたため、プログラマーが修正

----
以上。
