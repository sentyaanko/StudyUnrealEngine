# ■ 「UE4における大規模背景制作事例（最適化・ワークフロー編）」の要約

# ■ スライドへのリンク
* [{SlideShare} UE4における大規模背景制作事例（最適化・ワークフロー編）](https://www.slideshare.net/EpicGamesJapan/ue4-139190804)

# ■ 要約
## ■ 最適化・ワークフロー編
* 概要
	* 最適化にかかわる機能拡張やプロファイルツールに関してまとめられています。
	* ハードウェアのリソース状況についても事例を交えてまとめられています。
* 読むべき人
	* 主たるターゲット
		* デザイナー（リード、サブリード、背景担当）
		* プログラマー（リード、背景担当、コリジョン・PhysX 担当）
	* 補助的なターゲット
		* ディレクター（工数把握）

# ■ 講演者
* テクニカルアーティストの斎藤修氏
	* 背景処理の作り化のサポート、処理負荷の確認と改善など
* グラフィクスプログラマの吉岡国登氏
	* グラフィクス全般サポート
* グラフィクスプログラマの須山稔明氏
	* 背景グラフィクス案件のサポート、描画関連の不具合調査対応など

# ■ スライド内容のメモ
* ※ここから先はほぼスライドの内容全部を書き写しただけのスライド全体の俯瞰用のテキスト
* **詳細はスライド参照**
* レギュレーション
	* CPU/GPU/Memory の配分に従っているかの見える化
	* CPU/GPU
		* 負荷対策のための各制限について実際の数値と合わせてまとめられています
		* GPU/CPU それぞれのリアルタイムプロファイラを自作し、レギュレーションに収まっているかを実機チェック
		* GPU はデザイナが初めにチェック、CPU はプログラマーがチェックしていた
		* Actor 単位での表示切替や破棄を行える UI を用意することでデザイナーの確認もしやすく有用だった
		* 表示構成物（背景やキャラクターやＵＩ）のグループでの切り替えもでき、各セクション担当の確認もしやすく有用だった
	* Memory
		* リアルタイムプロファイリングツール、3種を利用
			* Memory/Assets/TexturePool
		* LLM は未使用（重く使用メモリも多かった）
* LOD
	* Simplygon を使用
	* プロパティマトリクスで情報が見れないため、 CSV にエクスポートする機能の追加
	* ライトマップ UV 共通オプションの追加によるベイクエラーの回避
	* HLOD は作成と捕手のコストが高く、メモリの使用量も大きいため、処理負荷が厳しいケースのみ限定的に使用
	* 生成は自動化した
* インスタンス
	* instance-tool を利用
* カリング
	* 事前カリング、距離カリング、オクルージョンカリングを利用
* ストリーミング
	* レベルストリーミング
		* 局所的に利用
		* 利用できないところは代わりにアクターマネージャによる Tick や表示の無効化などを行っている
	* テクスチャストリーミング
		* カメラがカット移動するたびにテクスチャ遅延が発生
		* 画角に非対応だったため、拡張
		* カットシーンでのテクスチャのリクエストリスの上書き機能
		* これらの結果、テクスチャプールのオーバーも発生、読み込み上限設定機能の追加
* ロード時間
	* ファイルオーダーの利用
	* 相互移動が多いマップの判断用にワールドコードという設定の追加
	* マップ移動後も参照されるメッシュ等は一時的に GameInstance から参照させ、再ロードを回避した
	* アセットレジストリは未使用（そうアセットが多く、メモリ使用量が多かったため）
* ディスク容量
	* 背景テクスチャの容量が問題になった
		* 見た目が許されるまで解像度を落とした
* ワークフロー
	* 各プラットフォームごとの描画状況の切り替え表示機能の追加
	* バッチやコマンドレットを大量に用意
	* 夜間の自動ビルド、ベイク
		* **ベイク用のビルドマシンの高速化について言及、詳細はスライド参照**
* Houdini
	* 破砕、ピボットペインター、積雪、モデル破壊、雲、フローマップ、ビルボード、テレイン、インスタンシング


----
以上。
